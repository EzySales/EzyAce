<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Projects â€” EzySales Academy</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root {--primary:#2563eb;--secondary:#0ea5e9;--text:#0f172a;--muted:#64748b;--bg:#f8fafc;--card:#ffffff;}
body{font-family:Inter;background:var(--bg);color:var(--text);margin:0}
header{background:#fff;padding:18px 32px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 8px rgba(0,0,0,0.06)}
nav a{margin-left:20px;font-weight:600;text-decoration:none;color:var(--text)}
nav a:hover{color:var(--primary)}
.section{max-width:1100px;margin:40px auto;padding:0 20px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:24px}
.card{background:var(--card);padding:20px;border-radius:14px;box-shadow:0 4px 12px rgba(0,0,0,0.05);display:flex;flex-direction:column}
.card img{width:100%;height:180px;object-fit:cover;border-radius:10px;margin-bottom:14px}
.btn{display:inline-block;margin-top:auto;background:var(--primary);color:white;padding:10px 16px;border-radius:10px;font-size:14px;font-weight:600;text-decoration:none;text-align:center}
.status{font-size:13px;font-weight:700;margin-bottom:6px}
.price{font-size:14px;color:var(--muted);margin-bottom:10px}
</style>
</head>
<body>
<header>
  <div style="font-weight:700;font-size:20px;color:var(--primary)">EzySales Academy</div>
  <nav>
    <a href="index.html">Home</a>
    <a href="onboarding.html">Onboarding</a>
    <a href="training.html">Videos</a>
    <a href="templates.html">Templates</a>
    <a href="weekly.html">Coaching</a>
    <a href="admin.html">Admin</a>
    <a href="team.html">Team</a>

  </nav>
</header>

<section class="section">
  <h1 style="font-size:32px;font-weight:700;margin-bottom:10px">Live Projects</h1>
  <p style="color:var(--muted);margin-bottom:30px;font-size:16px">All projects below are loaded automatically from Google Sheets. Update the sheet to add/remove projects.</p>

  <div id="projects" class="grid"></div>
</section>

<script>
const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQdJLPVCESvheBkcvv2JCcgR1jUtYFyOwoI7_IueG8dwfMbu4Ie3M2XdcStUls18BAi9z_dxPEdbbAH/pub?output=csv";

async function loadCSV(url){ const res = await fetch(url); const txt = await res.text(); return txt; }
function csvToArray(text){
  const lines = text.trim().split(/
?
/).filter(l=>l.trim()!=="");
  if(lines.length===0) return {headers:[],rows:[]};
  const headers = lines[0].split(',').map(h=>h.trim().replace(/^"|"$/g,''));
  const rows = lines.slice(1).map(line=>{
    const cols = line.split(','); const obj = {};
    headers.forEach((h,i)=> obj[h]= (cols[i]||'').replace(/^"|"$/g,'').trim());
    return obj;
  });
  return {headers,rows};
}

function slugify(t){ return (t||'').toString().toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,''); }

loadCSV(sheetURL).then(txt=>{
  const {headers,rows} = csvToArray(txt);
  const container = document.getElementById('projects');
  container.innerHTML = '';

  rows.forEach((r,idx)=>{
    // determine field names (flexible)
    const name = r.project_name || r.name || r.title || '';
    const price = r.price || '';
    const status = r.status || '';
    const image = r.image_url || r.image || '';
    const brochure = r.brochure_url || r.brochure || '';
    const whatsapp = r.whatsapp_group || r.whatsapp || r.wa || '';
    // slug can be provided or generated from name
    const slug = (r.slug && r.slug.trim()!=='') ? r.slug.trim() : slugify(name) || ('p'+idx);

    // details link: prefer a dedicated URL column, otherwise link to our detail page using slug
    const detailsLink = r.details_url && r.details_url.trim()!=='' ? r.details_url : `project-detail.html?slug=${encodeURIComponent(slug)}`;

    container.innerHTML += `
      <div class="card">
        <img src="${image}" alt="${name}">
        <div class="status">Status: ${status}</div>
        <div class="price">${price}</div>
        <h3 style="margin:6px 0 12px 0">${name}</h3>
        <a class="btn" href="${detailsLink}" target="_blank">View Details</a>
        ${ brochure? `<a class="btn" style="background:#0ea5e9;margin-top:10px;display:inline-block;text-align:center" href="${brochure}" target="_blank">Brochure</a>` : '' }
        ${ whatsapp? `<a class="btn" style="background:#10b981;margin-top:10px;display:inline-block;text-align:center" href="${whatsapp}" target="_blank">Join WhatsApp Group</a>` : '' }
      </div>
    `;
  });
}).catch(err=>{ document.getElementById('projects').innerHTML = '<div style="grid-column:1/-1">Failed to load projects. Check CSV link.</div>'; });
</script>

</body>
</html>
